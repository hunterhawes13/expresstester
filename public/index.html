<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Bowlby+One+SC|Press+Start+2P" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="clouds.css">
	<link rel="stylesheet" type="text/css" href="index.css">

    <script src="/horizon/horizon.js"></script>
    <script>
    const host = window.location.hostname + ':' + 3000;
      var horizon = Horizon({host:host});
      const chat = horizon("messages"); // create or use the table 'messages'
      const jingle = horizon("songs");
      horizon.onReady(function() {



        // Defined the object we want to store
        // this could be anything
        //
        // String, number, boolean, date
        //
        // and objects... but they must use only the 4 types above


// document.querySelector('#create').addEventListener('click', function() {        


        // function createMessage(author, text) {
        //   var message = {
        //     text: text,
        //     datetime: new Date(),
        //     author: author,
        //   };
        //   chat.store(message);
        // }
        // document.querySelector('#create').addEventListener('click', function() {
        //   createMessage(document.querySelector('#chat-author').value, document.querySelector('#chat-text').value);
        // });
        // chat.order('datetime', 'descending').watch().subscribe(function(items) {
        //   document.querySelector('#list');
        //   // Clear the list
        //   while (list.firstChild) {
        //     list.removeChild(list.firstChild);
        //   }
        //   items.forEach(function(item) {
        //     // Each result from the chat collection
        //     //  will pass through this function
        //     var listItem = document.createElement('div');
        //     var listItemText = document.createTextNode(item.author + ': ' + item.text);
        //     listItem.appendChild(listItemText);
        //     list.appendChild(listItem);
        //     console.log(item);
        //   })
        // },
        //   // If an error occurs, this function
        //   //  will execute with the `err` message
        // function(err) {
        //   console.log(err);
        // })



        // document.querySelector('.button').addEventListener('click', function() {
        //   obj.title.value, obj.artist.value;
        // });
        jingle.order('datetime', 'descending').watch().subscribe(function(items) {
          document.querySelector('#list');
          // Clear the list
          while (list.firstChild) {
            list.removeChild(list.firstChild);
          }
          items.forEach(function(item) { 
            // Each result from the song collection
            //  will pass through this function
                var listButton = document.createElement('button');
            listButton.className = "delete";
            listButton.id = item.id;
            listButton.source = item.type;
            listButton.addEventListener('click', function (e) {
                console.log(e.target.source)
                if (e.target.source === "soundcloud") {
                    jingle.remove(parseInt(e.target.id,10))
                } else {

                    jingle.remove(e.target.id)
                }
            })

            var listItem = document.createElement('div');
            listItem.className = "songs"; // <div class="songs">â‰ˆ</div>

            var listItemText = document.createTextNode(item.artist.replace(/\s/g, '') + ': ' + item.title.replace(/\s/g, ''));
    		var nameLinkNode = document.createElement('a'); 
    		nameLinkNode.setAttribute('href', 'https://itunes.com/' + encodeURIComponent(item.artist.replace(/\s/g, '')) + '/' + encodeURIComponent(item.title.replace(/\s/g, ''))); // 
    		listItem.appendChild(listButton);
    		nameLinkNode.appendChild(listItemText);
            listItem.appendChild(nameLinkNode);
            list.appendChild(listItem);

            console.log(item);

  // function handleDelete(id, e) {
  //     item.remove(id)
  //   }
          })



        },
          // If an error occurs, this function
          //  will execute with the `err` message.replace(/\s/g, '')
        function(err) {
          console.log(err);
        })

      });
      horizon.connect();
    </script>
  </head>
  <body>
<!--       <div id="overlay"></div>
<style>
    #overlay {
        position: fixed;
        background: rgba(0,0,0,0.8);
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
    }
    .hide {
        display: none;
    }
</style>
<script>
    $(window).load(function() {
     $('#overlay').addClass('hide');
    });
</script> -->

<div id="wrapper">
    <div id="a" class="panels">
		<div class="clouds">
    		<div class="tiki">

<!-- 				<div id="bpm">BPM Counter: Tap any key to the beat to find tempo</div> -->


				<div class="buttontop">
				<button id="popbutton">POP</button>
				<button id="altbutton">alt</button>



       </div>
     </div>
				<div id="clouds">
	<div class="cloud x1"></div>
	<!-- Time for multiple clouds to dance around -->
	<div class="cloud x2"></div>
	<div class="cloud x3"></div>
	<div class="cloud x4"></div>
	<div class="cloud x5"></div>
</div>
			</div>
		</div>
	</div>
</div>

<div id="b" class="panels">	
    <div id="cloudsimage" class="absolute"></div>
	<div id="alt"></div>
	<div id="mainstream"></div>
	<div id="white"></div>
    <div id="cloudsimage3" class="absolute"></div>
<footer>		    
       		<div id="cloudsimage2" class="absolute2"></div>
	<div id="bpm">BPM Counter: Tap any key to the beat to find tempo</div>
	<button id="clickme">See List</button>      
		<div id="root">
        	<div id="hider"><br></div>
       	<div id="list">	</div>

</footer>


<!-- <div class="clouds"></div> -->
<!-- <span class="mains">mainstream </span><span class="altfont"> ALT</span> 
 	<div class="tiki">

		<div id="bpm">Press space bar to find BPM</div>
			<div class="buttontop">
			<button id="popbutton">POP</button>
			<button id="altbutton">alt</button>

	</div>
</div>
<div class="white">yo</div>
<div id="alt"></div>
<div id="mainstream"></div> -->


<script   src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script>
    <script src="bpm.js"></script>
<script>


$(document).ready(function(){
    $("#popbutton").click(function(){
        $("#alt").hide();
        // $("#mainstream").show();
    });
    $("#altbutton").click(function(){
         $("#mainstream").hide();
        // $("#alt").show();
    });
});
// $(document).ready(function(){
//     $("#clickme").click(function(){
//          $("#list").toggle();

//     });
// });

$( "#popbutton" ).click(function() {
  $( "#mainstream" ).slideToggle( "slow", function() {
    // Animation complete.
  });
    $( "#white" ).show();
        $( "#cloudsimage" ).show();
        $("#alt").hide();
        $( "#cloudsimage3" ).show();
        $('#mainstream').animate({
        'marginTop' : "-=80px" //moves up
        });

        function exploder(){
        $('#mainstream').animate({
        'marginTop' : "+=80px" //moves down

        });
}
setTimeout(exploder, 1000);

});

$("#altbutton").click(function() {

  $( "#alt"  ).slideToggle( "slow", function() {
    // Animation complete.
  });
    $( "#white" ).show();
        $( "#cloudsimage" ).show();
        $("#mainstream").hide();
        $( "#cloudsimage3" ).show();
        $('#alt').animate({
        'marginTop' : "-=75px" //moves up
        });

        function explode(){
        $('#alt').animate({
        'marginTop' : "+=75px" //moves down

        });
}
setTimeout(explode, 1000);

     
});


$( "#clickme" ).click(function() {
  $( "#list" ).slideToggle( "slow", function() {
    // Animation complete.
  });
});



</script>

<script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
<script>
  SC.initialize({
    client_id: '9f5ea1e532c10e0356eb3a04ab196679',
    redirect_uri: 'http://example.com/callback'
  });
</script>


<script type="text/javascript">

$.getJSON( "/underground", function( data ) {
	//console.log(data.collection);
  var items = [];
  $.each( data.collection, function( key, val ) {
    // items.push( "<li id='" + key + "'>" + val.origin.title + "</li>" );
    SC.oEmbed(val.origin.permalink_url, {
 	 auto_play: false 
	}).then(function(embed){
  	//	console.log('oEmbed response: ', embed.html);
// $('iframe, </button>').wrapAll('<div class="scFrame" />');
  		$(embed.html).appendTo("#alt");
  		$('<button class="buttonSC" id='+val.origin.id+' type="button" onClick="addToList({ type:\'soundcloud\',id:' +val.origin.id+',title: \''+val.origin.title+'\',artist:\''+val.origin.user.username+'\',datetime:\''+new Date()+'\',permalink_url:\''+val.origin.permalink_url+'\'})">Add to List</button>' + '<button class="buttonSC" type="button">Download Track</button>').appendTo("#alt");
 // class="buttonSC" type="button">Download Track</button>').appendTo("#alt");
	});
  });
 
  // $( "<ul/>", {
  //   "class": "my-new-list",
  //   html: items.join( "" )
  // '<a href='+val.origin.permalink_url+'/download' + 'class="buttonSC" target="_blank" type="button">Download Track</a>'
  // }).appendTo( "#create" );
});

function addToList (obj) {
	//console.log(obj);

        jingle.store(obj);

}

// spotifyApi.getPlaylist('spotify', '2qlMTcW6AnnaGl7eXWAZP5')
//   .then(function(data) {
//     //console.log('Some information about this playlist', data.body);
//   }, function(err) {
//     //console.log('Something went wrong!', err);
//   });

$.getJSON( "/mainstream", function( data ) {
	//console.log(data.items);
	var spotifyTracks = data.items.map( function (item ) {
		var iframe=$( '<iframe src="https://embed.spotify.com/?uri=' + encodeURI(item.track.uri) +'" width="100%" height="380" frameborder="0" allowtransparency="true"></iframe>' + '<div class="button-container">' + '<button class="button" type="button" id='+item.track.id+' onClick="addToList({ type:\'spotify\', id: \''+item.track.id+'\',title: \''+item.track.name+'\',artist:\''+item.track.artists[0].name+'\',datetime:\''+new Date()+'\',permalink_url:\''+item.track.preview_url+'\'})">Add to List</button>' + '<a href="http://itunes.com/'+encodeURIComponent(item.track.artists[0].name.replace(/\s/g, ''))+'/'+encodeURIComponent(item.track.name.replace(/\s/g, ''))+' " class="button" target="_blank" type="button">Download Track</a>' + '</div>')
		iframe.appendTo("#mainstream");
		return item.track.name
	});
//console.log(spotifyTracks)

});




</script>

<!-- ,id:'+item.track.id+',title: \''+item.track.name+'\',artist:\''+item.track.artists[0].name+'\',permalink_url:\''+item.track.preview_url+'\' -->


</body>
</html>